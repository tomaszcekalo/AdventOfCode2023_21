// See https://aka.ms/new-console-template for more information
using System.Drawing;

Console.WriteLine("Hello, World!");

var input = @"...................................................................................................................................
.........#.............#..#.................................#..........#......##.............#.#..#.#......................##......
...#.................#.....#........#.#............#...#...#................##............#...#.............#.....#.......#........
...........#.#.#...........#................#....#....................................#........#..#...............#................
...#.......#...#...#...........#.#....##...........#...#...............................#..................#..#.#..#....#.#.#.......
..##.#.................#........#...........................................#...#...................................#..............
......#......................##....##......#.......................................#.........#........#...........#.#..............
...#.....#.......#...............#....##...#......#..#.......................#...#.#....#.........#.#.......#......................
..................................#...#.............#.............#.#..............#.......#.....................#.#...............
..#........#...............#....#....##.....#.....#..............................#.....#...#...#..#..............#.................
.#................................#.............##................#...#...................#............#.#....#...#.#.....#..#.....
..............#......#......................#.............#..#.........................#......##....#...........#.........#...###..
...#..............#.............#.....##.........#...................#...#...........#.....#..........#...............#.........#..
...#........#......................#.#....#...#...............#....................................#.#..#..........................
..........#.#.........#...#...#..........#..#...............#.........#....#..................................##.#.................
..#...........#...............#.........#...#.........##...#....#....................#....#..#.....#.....###.#.....#...............
...........................................#................#..............##............#.....#...#...............#...##.....##...
.......#...........#....#.....#.......................#.##..........#...#.................#.......#...................##...........
...........#.....#............#........#............#..........#.........##..#...................#..........................#......
.......#....#..##..........#..........#..............#.##.............................................#.....#.....#...#.#....#.....
..#...#.............#......#.#....#....#.........#.....#............#....#.......#.......#..#.#.....#...........#.............#.#..
...#.......#.....#...#.......##....#............................#...........#.............................#........#........#....#.
.............#.....##.#............#.#............................................#........#........#...#........#........##.#..#..
.....#..#..#......#.............................#.......#.........#..#.............#................##..#.........#........#.......
....#.......#...............#......#............................#.......#.#.............................................#..#.......
.....#.........#..............#..............#...............#..........#.........................#.#...#..#.......#........#...#..
.........................#.............................#...#.......#................................#.....#.#.....#...........#....
..............#......#......................##....#................#....#...........##.................#.........#.....##..........
..........#.....................#.........#...........#.....#........#...................................#.........................
..#...#..##..............#..............#.......#...............#.#.......#...........#.#.................##......#.........#.#....
.....##........#....##......#..................#...#...................#...........##.##..#...........#............#...............
...#............#..#...#.................#................................#.....#..#.....#...........#..#......#.##...#..#.....#...
......#.#...#...#......................#..#....................#......................................#......#...........#..#...#..
..............................................#..##...............#.......#..#...#.......##.#.#.........................#...#......
..#......#...#...........#..........#.....................#..........##...#....#.#......#..#.......................................
....#.......##..............................................#........##.....#......#.#..............................#........#.....
..................##..#.................................#........................................................#............#....
......#....#.........................#.#......#.....##......#........#.#........#.............#...........#..................#.....
.##....................#.............#.....#..........#...#.........##..........#............##.............#........#.............
..............#.....#............#.......................#.....##.........##..#........................................#...........
..............#...................................#.#.#......#..#....#............##.#..#.................................#........
....#..#............................#..#...#.......................................................#...........................#...
........#......#...........#.#.........##.#................#.##.....................#...............................#..............
...........................#......#.........................#..#..#...........#.................#.............................#..#.
......#...................#...#.........#.....#.........#.......#....#.......#......#...#.................................#........
....#.#..#...#...........#....#...........#..........#.........#........................#.#...............#.............#..........
.#............#.......................................#......#.#............###...................##.....#.............#...........
.......#....................................#.#..........#.#...#.........#.....#................#.....#...#........................
...........#.......................##.....#..#........##..............#.............#...........................................#..
........#.##.........#..........#........#.................#..............#......###....#........#.....................#.#.....#...
.....##.#...................#.............#........................#..................#..................###.............#.........
......................#.............#.#.....#..#............#......#...#.#.................#....#........#...................#.....
..#..................#.#..#............#.......#..............................................................#.#................#.
..#...#.................#..#.........#........#...#.#.#......#....#.#...#............#...........#.......#.........................
..#........................##...............................#.......#.......##.........#....#........#......#...............#......
...............#.#...........#...........#................#.#..#.........#.........#.........#..................#..#..........#....
.............#......#......#..#.#......#...#.#.................................#........#..#......#................#...........##..
............#.........................#..................................#......#...........#........#.............................
...#.......#.................#............#........................#.#...........#.#.............#.................................
.............#.......#.........#..............#..#..#.......#..............##.........#....#........##.#...#.......................
.....................#.#.........#.....#..#.........#................##.....#.#....................#........#......................
........#.........#......#...#.#............................#.......#..............#....#............#..###....#....#.#............
..................#.##..##.....#....#........................#..#....................#..#.....#..#..............#..................
..........#..##..........#.......##.#..#...........#..............#..#..........................#....#........#........#...........
.............#...#..#......#.#.....................................#..#.............#.......#....#............#....................
.................................................................S.................................................................
.................##.#...#.......#.....................#.#..............#......#..........#.##.........#.........##.................
............................#..#..................#............##................#.......#.....##........................##........
..................#......................#............#....#.#..#.....#..........#.#........................#.......#....#.........
........##.....#.#.........................#..#.....#...#.....#....#...#...#............#...............#.#........................
..............#....#.#...............#......#...............................#......#......#..............#.........................
.#.............##..#...................#.......#...........#...#................#.......#.........#.#...#..........#.#..#..........
......................#....................#.........................#.#........#........#............#....#......#.............#..
...#...............#......##......#.......#.....#..#.....#.................#..#.#.........#.....#........#....#....................
......................#....#...............#.....................................#.................#.........................#.#...
.....#.............#.....................#................#.......##...............................................................
...#...........#..................#............#........#...............#.............#......................................#.#...
.....#...............#.#......#.#...#..#...#..#........#.............................#.............#.........................#.....
.#.................#.....................#.......#..........#..........#....#.......#............#...#...#.........................
.........#..............##...............#.............#..#...#..............##....#..#.#.#..#...#.....#...#.....................#.
.#.......#.#...................#.#...............#.....#...#............................#....#......#..............................
....................#...#.....#................#..........#.....................................#....#.#.....#.....................
.........................................#.....#...............#.......#.........#.#.#......#...#.........................#...##...
..#.##...........................#.#.................................................#.......#.#....................#.....#..##....
..#.........#..#........##................#.......#..................#.#.........#.#.......#................................#......
....#....#................#..........#.#..........#...........#...#............#.....#................#..............#..#....#.....
..#.............#........#.....#...#..........#.........#...........#.......#............................#..................#.##...
....##...........##.............#...........#......#..........#.....#........................#.###................#.......#.....#..
........#..#.......................................................#.......#..........##.#..........#.#.............#.....#.#.#.#..
.#.#......#.###.................#....................................#...#..#..............#....#.#..##............#..#............
...........#....#...............##.#......#....#...#............................................#....#.........................#...
....#.............#................................#.......#...#..........##..................#...............................#....
........#.#.#..#.....................#.....##.#..#.......#..........#............................#........................#........
...........#.....................##.........#...#..........#....................##....................................##....#...#..
.....#.#......................................##........#..................#................................#.........#............
...#....#......#.....#....................#.............#...#......#.#...#............#..##...........................#........#...
..#....................#.............................#..........#.................##..##.#...#...................#....#.....##.....
...........................................##................#..#...........................#.............#.....#.............#.#..
.....................#......#.........#......#.......#.............................#...............................#........###....
............#........#......#.#..............##................#...#...................................................#...........
.................#...........#....................#..#............#.........#......................#..#.....................#......
.#..............#............##..................#..#...#....#....##.......#..#.#........#.........#.......#..#...#................
............#...#.................................#.#........................###....#..........................#.................#.
.......#.....#.........#....................#.............#..........#............#............................................##..
............#..#..............#....#............#.......#...#.....#........#........#...........#..#...#.....................#.#...
....#.#...........................#..............#...........#.......#................#...........#.##.....#............#..#.......
..........#...........#...#......#...............#.............#.......#......................#..........................#.........
..#.......#.#............#.......#...............#.......#................................................#.......#................
............#..............#........#..........#...#.....................#....#.............#.#.###.......#....#...................
....#..........#.#.....#.............#.................#......##.........#.......#..........#..................#........#..........
..#.#.#.........##....#.........#..........................###............................#......##...#.......#........#.......#...
....#....#.....................#..................#.#.#...............#........#..........................#.....#..............##..
.......#...#......#.......#..............#..................#.##........#.#.................................#......#..........#....
...#.....#...........##..##....#.....#.................#.....................................#......#....##...#.............#......
..........#.........................#...........................#.#........#.........#..#.....#.........#....#..##...#.#......#....
............................#.....#.#..#...#..................#.....................#........##..#............#....................
......#.............#........................................#.........#........................#..#...........#...#..#.....#......
...........#.....#................#.#..#........#...........#.....##...............................#...............#..........##...
......................#.........................#.........#....#...............................##.......#..#....#...#..............
..#.....#.......#....................##...........#...........#.................#.......#..........................................
....#....#..#............#......#..#..#.#..#......#...................#.........#...............#.#..#....................#........
........##..............................#.#.................##......................#...............#..#......#......#..........#..
.....#..#...........#.#.......#...............#.................................#......#...........................................
....##.##............#..............#..#..............#.........#...................................#.......#......................
.....#....#.....#........#......#..............................#...........#.........##......#...#............##...................
....#..........#..#............##..#....#.#....#..#.............#...........#.#............#......#........#.......#.#.............
........#..##.....#......##...............#......#.#.............................#..#...#........#....#..............#........#....
..#.................#....#...#........##.....#.............................#..#.#......#.....#...#................#................
...........#.#....................#.......##.........................................#..............#..#.............#.......#.....
..#.....#......#.....................................#......................................#................#.#........#..........
...................................................................................................................................";
var inputSmall = @"...........
.....###.#.
.###.##..#.
..#.#...#..
....#.#....
.##..S####.
.##..#...#.
.......##..
.##.#.####.
.##..##.##.
...........";

//int distance = 6;
//var counter = new StepCounter(inputSmall);
//var area = counter.CalculateSteps(distance);
int distance = 64;
var counter = new StepCounter(input);
var area = counter.CalculateSteps(distance);
Console.WriteLine($"In this example, if the Elf's goal was to get exactly {distance} more steps today, he could use them to reach any of {area} garden plots.");

public class Step
{
    public Point Position { get; set; }
    public int Distance { get; set; }
}

public class StepCounter
{
    public StepCounter(string input)
    {
        Lines = input.Split(Environment.NewLine);
        StartX = 0;
        StartY = 0;

        for (int y = 0; y < Lines.Length; y++)
        {
            if (Lines[y].Contains('S'))
            {
                StartY = y;
                StartX = Lines[y].IndexOf('S');
                break;
            }
        }
    }

    public int CalculateSteps(int distance)
    {
        Dictionary<Point, int> area = new Dictionary<Point, int>();
        Queue<Step> steps = new Queue<Step>();
        //List<Step> covered = new List<Step> { };
        steps.Enqueue(new Step()
        {
            Distance = 0,
            Position = new Point(StartX, StartY),
        });

        while (steps.Count > 0)
        {
            var step = steps.Dequeue();
            //if (area.ContainsKey(step.Position))
            //    continue;
            area[step.Position] = step.Distance;
            //covered.Add(step);
            var posX = step.Position.X;
            var posY = step.Position.Y;

            if (step.Distance >= distance)
                continue;

            if (posY > 0 && Lines[posY - 1][posX] != '#')
                if (!steps.Any(x => x.Position.X == posX && x.Position.Y == posY - 1))
                    steps.Enqueue(new Step()
                    {
                        Position = new Point(posX, posY - 1),
                        Distance = step.Distance + 1,
                    });

            if (posX > 0 && Lines[posY][posX - 1] != '#')
                if (!steps.Any(x => x.Position.X == posX - 1 && x.Position.Y == posY))
                    steps.Enqueue(new Step()
                    {
                        Position = new Point(posX - 1, posY),
                        Distance = step.Distance + 1,
                    });

            if (posX < Lines[posY].Length - 1 && Lines[posY][posX + 1] != '#')
                if (!steps.Any(x => x.Position.X == posX + 1 && x.Position.Y == posY))
                    steps.Enqueue(new Step()
                    {
                        Position = new Point(posX + 1, posY),
                        Distance = step.Distance + 1,
                    });

            if (posY < Lines.Length - 1 && Lines[posY + 1][posX] != '#')
                if (!steps.Any(x => x.Position.X == posX && x.Position.Y == posY + 1))
                    steps.Enqueue(new Step()
                    {
                        Position = new Point(posX, posY + 1),
                        Distance = step.Distance + 1,
                    });
        }

        //return covered
        //    .Where(x => x.Distance == distance)
        //    .Select(x => x.Position)
        //    .Distinct()
        //    .Count();
        return area
            .Where(x => x.Value == distance)
            .Count();
    }

    public string[] Lines { get; private set; }
    public int StartY { get; }
    public int StartX { get; }
}